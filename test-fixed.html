<!DOCTYPE html>
<html>
<head>
    <title>Pool Game - Fixed Version</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/game-layout.css"/>
</head>
<body>
    <!-- Mobile Interface -->
    <div class="mobile-container">
        <!-- Header -->
        <div class="mobile-header">
            <h1>üé± 8Ball Arena</h1>
            <div class="wallet-section">
                <button id="connect-wallet-btn" onclick="connectWallet()">Connect Wallet</button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Mini Games Section -->
            <div class="mini-games-section">
                <h2>üéÆ Mini Games</h2>
                
                <button class="mini-game-btn" onclick="testDailyBreak()">
                    Daily Break (Test)
                </button>
                
                <button class="mini-game-btn" onclick="testReferral()">
                    Referral System (Test)
                </button>
            </div>
        </div>

        <!-- Game Canvas (Hidden by default) -->
        <div class="game-canvas-container" id="game-canvas-container" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #000; z-index: 9999; justify-content: center; align-items: center;">
            <div id="gameArea" style="position: relative;">
                <canvas id="screen" width="1500" height="825" style="background: #0f5d0f; border: 4px solid #8B4513; border-radius: 15px; max-width: 95vw; max-height: 90vh;"></canvas>
            </div>
        </div>
    </div>

    <!-- Load Scripts -->
    <script src="script/lib/LAB.min.js"></script>
    
    <script>
        // Test functions to isolate the issues
        function testDailyBreak() {
            console.log('üîç Testing Daily Break...');
            alert('Daily Break button clicked! Check console for details.');
            
            // Show the game canvas
            const gameCanvasContainer = document.getElementById('game-canvas-container');
            if (gameCanvasContainer) {
                gameCanvasContainer.style.display = 'flex';
                console.log('‚úÖ Canvas container shown');
                
                // Try to draw something simple on the canvas
                const canvas = document.getElementById('screen');
                const ctx = canvas.getContext('2d');
                
                if (ctx) {
                    // Clear canvas
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    // Draw pool table background
                    ctx.fillStyle = '#0f5d0f';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    // Draw table border
                    ctx.strokeStyle = '#8B4513';
                    ctx.lineWidth = 20;
                    ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);
                    
                    // Draw some test balls
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.arc(400, 400, 15, 0, 2 * Math.PI);
                    ctx.fill();
                    
                    ctx.fillStyle = 'red';
                    ctx.beginPath();
                    ctx.arc(1000, 400, 15, 0, 2 * Math.PI);
                    ctx.fill();
                    
                    ctx.fillStyle = 'blue';
                    ctx.beginPath();
                    ctx.arc(1030, 390, 15, 0, 2 * Math.PI);
                    ctx.fill();
                    
                    console.log('‚úÖ Test pool table drawn successfully!');
                    
                    // Add close button
                    addTestCloseButton();
                } else {
                    console.error('‚ùå Cannot get canvas context');
                }
            } else {
                console.error('‚ùå Canvas container not found');
            }
        }
        
        function testReferral() {
            console.log('üîç Testing Referral System...');
            alert('Referral button clicked! Opening referral interface...');
            
            // Create a simple referral modal
            const modal = document.createElement('div');
            modal.id = 'test-referral-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: #2a2a2a;
                padding: 30px;
                border-radius: 15px;
                color: white;
                text-align: center;
                max-width: 400px;
                width: 90%;
            `;
            
            content.innerHTML = `
                <h2>üéØ Referral System</h2>
                <p>Share your referral link with friends!</p>
                <div style="margin: 20px 0;">
                    <strong>Your Referral Code:</strong><br>
                    <input type="text" value="POOL123" readonly style="width: 100%; padding: 10px; margin: 10px 0; background: #1a1a1a; color: white; border: 1px solid #4ECDC4; border-radius: 5px;">
                </div>
                <div style="margin: 20px 0;">
                    <strong>Your Referral Link:</strong><br>
                    <input type="text" value="${window.location.href}?ref=POOL123" readonly style="width: 100%; padding: 10px; margin: 10px 0; background: #1a1a1a; color: white; border: 1px solid #4ECDC4; border-radius: 5px;">
                </div>
                <button onclick="copyReferralLink()" style="background: #4ECDC4; border: none; padding: 10px 20px; border-radius: 5px; color: white; margin: 5px;">
                    Copy Link
                </button>
                <button onclick="closeTestReferral()" style="background: #ff6b6b; border: none; padding: 10px 20px; border-radius: 5px; color: white; margin: 5px;">
                    Close
                </button>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            console.log('‚úÖ Referral modal created successfully!');
        }
        
        function addTestCloseButton() {
            const closeBtn = document.createElement('button');
            closeBtn.innerHTML = '‚ùå Close';
            closeBtn.style.cssText = `
                position: absolute;
                top: 20px;
                right: 20px;
                background: #ff6b6b;
                border: none;
                padding: 10px 20px;
                border-radius: 5px;
                color: white;
                cursor: pointer;
                z-index: 10001;
            `;
            closeBtn.onclick = function() {
                const container = document.getElementById('game-canvas-container');
                if (container) {
                    container.style.display = 'none';
                    closeBtn.remove();
                }
            };
            
            const gameArea = document.getElementById('gameArea');
            if (gameArea) {
                gameArea.appendChild(closeBtn);
            }
        }
        
        function copyReferralLink() {
            const link = `${window.location.href}?ref=POOL123`;
            navigator.clipboard.writeText(link).then(() => {
                alert('Referral link copied to clipboard!');
            }).catch(() => {
                alert('Copy failed. Please copy manually: ' + link);
            });
        }
        
        function closeTestReferral() {
            const modal = document.getElementById('test-referral-modal');
            if (modal) {
                modal.remove();
            }
        }
        
        function connectWallet() {
            alert('Wallet connection test - this would connect to Phantom wallet');
            console.log('üîç Testing wallet connection...');
        }
        
        // Test if scripts are loading properly
        console.log('üöÄ Pool Game Test Version Loaded');
        console.log('- LAB.js available:', typeof $LAB !== 'undefined');
        
        // Add error handling
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('‚ùå JavaScript Error:', msg, 'at line', lineNo);
            alert('JavaScript Error: ' + msg);
            return false;
        };
    </script>
</body>
</html>