<!DOCTYPE html>
<html>
<head>
    <title>Pool Game - Error Fix Test</title>
    <style>
        body { background: #1a1a1a; color: white; font-family: Arial; margin: 20px; }
        .status { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #2d5a2d; }
        .error { background: #5a2d2d; }
        .warning { background: #5a5a2d; }
        button { padding: 10px 20px; margin: 10px; background: #4ECDC4; border: none; border-radius: 5px; color: white; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Pool Game Error Fix Verification</h1>
    
    <div id="status-container"></div>
    
    <button onclick="testCanvasScale()">Test Canvas2D Scale Fix</button>
    <button onclick="testGamePolicy()">Test GamePolicy Fix</button>
    <button onclick="testMiniGameSystem()">Test MiniGameSystem Fix</button>
    
    <script src="script/lib/LAB.min.js"></script>
    <script>
        function addStatus(message, type = 'success') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            document.getElementById('status-container').appendChild(div);
        }
        
        function testCanvasScale() {
            addStatus('üîç Testing Canvas2D Scale Fix...', 'warning');
            
            $LAB.script('script/geom/Vector2.js').wait(() => {
                $LAB.script('script/Canvas2D.js').wait(() => {
                    try {
                        // Test Canvas2D scale getter when canvas is null
                        const scale = Canvas2D.scale;
                        addStatus(`‚úÖ Canvas2D.scale works when canvas is null: ${scale.x}, ${scale.y}`, 'success');
                    } catch (error) {
                        addStatus(`‚ùå Canvas2D.scale error: ${error.message}`, 'error');
                    }
                });
            });
        }
        
        function testGamePolicy() {
            addStatus('üîç Testing GamePolicy Fix...', 'warning');
            
            $LAB.script('script/geom/Vector2.js').wait(() => {
                $LAB.script('script/game_objects/Score.js').wait(() => {
                    $LAB.script('script/Game.js').wait(() => {
                        $LAB.script('script/GamePolicy.js').wait(() => {
                            try {
                                // Create GamePolicy when Game.size is undefined
                                const policy = new GamePolicy();
                                addStatus('‚úÖ GamePolicy created successfully without Game.size', 'success');
                            } catch (error) {
                                addStatus(`‚ùå GamePolicy error: ${error.message}`, 'error');
                            }
                        });
                    });
                });
            });
        }
        
        function testMiniGameSystem() {
            addStatus('üîç Testing MiniGameSystem Fix...', 'warning');
            
            if (typeof MiniGameSystem !== 'undefined') {
                try {
                    const stats = MiniGameSystem.getStats();
                    addStatus(`‚úÖ MiniGameSystem available with stats: ${JSON.stringify(stats)}`, 'success');
                } catch (error) {
                    addStatus(`‚ùå MiniGameSystem error: ${error.message}`, 'error');
                }
            } else {
                addStatus('‚ö†Ô∏è MiniGameSystem not found - this should be fixed in main file', 'warning');
            }
        }
        
        // Run basic tests on load
        window.onload = function() {
            addStatus('üöÄ Error Fix Test Page Loaded', 'success');
            
            if (typeof $LAB === 'undefined') {
                addStatus('‚ùå LAB.js not loaded', 'error');
            } else {
                addStatus('‚úÖ LAB.js loaded successfully', 'success');
            }
        };
    </script>
</body>
</html>